<!DOCTYPE html>
<html>
<head>
<title>jQuery源码解析1(Utilities)</title>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<style type="text/css">
</style>
</head>
<body>

<h2>jQuery源码解析1(Utilities)</h2>
<p>转自: <A href="http://bencode.javaeye.com/blog/573349" target=_blank>http://bencode.javaeye.com/blog/573349</A>
</p>
<DIV class=blog_main>
<P>使用jquery两年多了,&nbsp; 我最早是使用的是prototype库，后来使用mootools， 直到后来弟弟推荐我使用jquery(他是个UI设计师)，就一直用到现在。
我是被它的简洁和精炼所吸引的。</P>
<P>&nbsp;</P>
<P>我喜欢看源代码，以前开发eclipse rcp时，就喜欢看eclipse的源码，因为有时候API文档并不那么明了，eclipse优秀的架构配合JDT强大的功能，让我们很容易地看懂。
一个设计优秀的产品，它的代码应该也是易于理解的。 现在我做web用的是php的ci，在开发过程中也是时常查看它的源代码。</P>
<P>&nbsp;</P>
<P>为了更好地使用jquery, 所以我阅读了jquery的源代码。不敢独享，所以写出来，相互讨论，一起进步。</P>
<P>&nbsp;</P>
<P><STRONG>我使用的是 1.3.2</STRONG></P>
<P>&nbsp;</P>
<P>我们<STRONG>从开始的地方开始</STRONG> ：</P>
<P>&nbsp;</P>
<DIV class=dp-highlighter>
<DIV class=bar>
<DIV class=tools>Js代码</DIV>
</DIV>
<OL class=dp-c>
	<LI><SPAN><SPAN>(</SPAN><SPAN class=keyword>function</SPAN><SPAN>()&nbsp;{
	&nbsp;&nbsp;</SPAN></SPAN></LI>
	<LI><SPAN>&nbsp;...&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;</SPAN></LI>
	<LI><SPAN>})();&nbsp;&nbsp;</SPAN></LI>
</OL>
</DIV>
<PRE style="DISPLAY: none" class=js name="code">(function() {
 ...	
})();</PRE>
<P>&nbsp;</P>
<P><STRONG>所有代码包含在以上的函数中，避免名字冲突。</STRONG></P>
<P>&nbsp;</P>
<P><STRONG>1. 几个"全局变量"</STRONG></P>
<P>&nbsp;</P>
<DIV class=dp-highlighter>
<DIV class=bar>
<DIV class=tools>Java代码</DIV>
</DIV>
<OL class=dp-j>
	<LI><SPAN><SPAN>var&nbsp; &nbsp;&nbsp;</SPAN></SPAN></LI>
	<LI><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;window&nbsp;=&nbsp;</SPAN><SPAN class=keyword>this</SPAN><SPAN>,
	&nbsp;&nbsp;</SPAN></LI>
	<LI><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;undefined,&nbsp; &nbsp;&nbsp;</SPAN></LI>
	<LI><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;_jQuery&nbsp;=&nbsp;window.jQuery,&nbsp; &nbsp;&nbsp;</SPAN></LI>
	<LI><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;_$&nbsp;=&nbsp;window.$, &nbsp;&nbsp;</SPAN></LI>
	<LI><SPAN>&nbsp;&nbsp;</SPAN></LI>
	<LI><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;jQuery&nbsp;=&nbsp;window.jQuery&nbsp;=&nbsp;window.$&nbsp;=&nbsp;function(selector,&nbsp;context)&nbsp;{
	&nbsp;&nbsp;</SPAN></LI>
	<LI><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=keyword>return</SPAN><SPAN>&nbsp;</SPAN><SPAN
		class=keyword>new</SPAN><SPAN>&nbsp;jQuery.fn.init(selector,&nbsp;context); &nbsp;&nbsp;</SPAN></LI>
	<LI><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;}, &nbsp;&nbsp;</SPAN></LI>
	<LI><SPAN>&nbsp;&nbsp;</SPAN></LI>
	<LI><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=comment>//&nbsp;A&nbsp;simple&nbsp;way&nbsp;to&nbsp;check&nbsp;for&nbsp;HTML&nbsp;strings&nbsp;or&nbsp;ID&nbsp;strings
	</SPAN><SPAN>&nbsp;&nbsp;</SPAN></LI>
	<LI><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;quickExpr&nbsp;=&nbsp;/^[^&lt;]*(&lt;(.|\s)+&gt;)[^&gt;]*$|^#([\w-]+)$/,
	&nbsp;&nbsp;</SPAN></LI>
	<LI><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=comment>//&nbsp;Is&nbsp;it&nbsp;a&nbsp;simple&nbsp;selector
	</SPAN><SPAN>&nbsp;&nbsp;</SPAN></LI>
	<LI><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;isSimple&nbsp;=&nbsp;/^.[^:#\[\.,]*$/;&nbsp;&nbsp;</SPAN></LI>
</OL>
</DIV>
<PRE style="DISPLAY: none" class=java name="code">var 
	window = this,
	undefined, 
	_jQuery = window.jQuery, 
	_$ = window.$,

	jQuery = window.jQuery = window.$ = function(selector, context) {
		return new jQuery.fn.init(selector, context);
	},

	// A simple way to check for HTML strings or ID strings
	quickExpr = /^[^&lt;]*(&lt;(.|\s)+&gt;)[^&gt;]*$|^#([\w-]+)$/,
	// Is it a simple selector
	isSimple = /^.[^:#\[\.,]*$/;</PRE>
<P>&nbsp;</P>
<P>1.1</P>
<P>&nbsp;</P>
<P>&nbsp;<STRONG>window </STRONG>还是那个window, <STRONG>undefined</STRONG> 还是那个undefined，只是这样让js
解释器更快地找到他们，提高速度。</P>
<P>&nbsp;</P>
<P>&nbsp;_<STRONG>jQuery</STRONG> = window.jQuery</P>
<P><STRONG>_$</STRONG> = window.$,</P>
<P>&nbsp;</P>
<P>保存原来的 jQuery 和 $, 因为默认情况下jquery占用名字空间 jQuery 和$</P>
<P>&nbsp;</P>
<P>搜索一下使用 _jQuery的地方吧：</P>
<P>&nbsp;</P>
<P>&nbsp;</P>
<DIV class=dp-highlighter>
<DIV class=bar>
<DIV class=tools>Java代码</DIV>
</DIV>
<OL class=dp-j>
	<LI><SPAN><SPAN>jQuery.extend({ &nbsp;&nbsp;</SPAN></SPAN></LI>
	<LI><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;noConflict:&nbsp;function(&nbsp;deep&nbsp;)&nbsp;{
	&nbsp;&nbsp;</SPAN></LI>
	<LI><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;window.$&nbsp;=&nbsp;_$;
	&nbsp;&nbsp;</SPAN></LI>
	<LI><SPAN>&nbsp;&nbsp;</SPAN></LI>
	<LI><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=keyword>if</SPAN><SPAN>&nbsp;(&nbsp;deep&nbsp;)
	&nbsp;&nbsp;</SPAN></LI>
	<LI><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;window.jQuery&nbsp;=&nbsp;_jQuery;
	&nbsp;&nbsp;</SPAN></LI>
	<LI><SPAN>&nbsp;&nbsp;</SPAN></LI>
	<LI><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=keyword>return</SPAN><SPAN>&nbsp;jQuery;
	&nbsp;&nbsp;</SPAN></LI>
	<LI><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;},&nbsp;&nbsp;</SPAN></LI>
</OL>
</DIV>
<PRE style="DISPLAY: none" class=java name="code">jQuery.extend({
	noConflict: function( deep ) {
		window.$ = _$;

		if ( deep )
			window.jQuery = _jQuery;

		return jQuery;
	},</PRE>
<P>&nbsp;</P>
<P>OK， 是为了 <STRONG>noConflict</STRONG>。</P>
<P>&nbsp;</P>
<P>比如我们要同时使用prototype和jquery, 可以先让html页面包含 prototype.js 再包含 jquery.js。</P>
<P>&nbsp;</P>
<P>然后调用&nbsp; jq = jQuery.noConflict();&nbsp;&nbsp; 接着就可以用jq来使用jQuery框架， $ 就变回 prototype.js
中的方法了。</P>
<P>&nbsp;</P>
<P>还有一个deep参数， 可以让另一个jQuery(可能不怎么有名， 但对你的项目有用) 和 现在的jQuery 共存。</P>
<P>&nbsp;</P>
<P>&nbsp;</P>
<P><STRONG>quickExpr</STRONG>:&nbsp; <STRONG>是一个正则表达式， 用于快速匹配一个 html tag 或 id 字符串（如
'#id')</STRONG></P>
<P><STRONG>isSimple</STRONG>: <STRONG>也是一个与此同时表达式, 用于匹配一个 selector (css 选择器)</STRONG></P>
<P>&nbsp;</P>
<P>1.2</P>
<P>&nbsp;</P>
<P>&nbsp;</P>
<DIV class=dp-highlighter>
<DIV class=bar>
<DIV class=tools>Java代码</DIV>
</DIV>
<OL class=dp-j>
	<LI><SPAN><SPAN>jQuery&nbsp;=&nbsp;window.jQuery&nbsp;=&nbsp;window.$&nbsp;=&nbsp;function(selector,&nbsp;context)&nbsp;{
	&nbsp;&nbsp;</SPAN></SPAN></LI>
	<LI><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=keyword>return</SPAN><SPAN>&nbsp;</SPAN><SPAN
		class=keyword>new</SPAN><SPAN>&nbsp;jQuery.fn.init(selector,&nbsp;context); &nbsp;&nbsp;</SPAN></LI>
	<LI><SPAN>},&nbsp;&nbsp;</SPAN></LI>
</OL>
</DIV>
<PRE style="DISPLAY: none" class=java name="code">	jQuery = window.jQuery = window.$ = function(selector, context) {
		return new jQuery.fn.init(selector, context);
	},
</PRE>
<P>&nbsp;</P>
<P>我们思考： jQuery.fn.init 是构造函数， 那它的实例方法应该由 : jQuery.fn.init.prototype 指定。</P>
<P>&nbsp;</P>
<P>搜索它， 在541行得到以下代码：</P>
<P>&nbsp;</P>
<P>&nbsp;</P>
<DIV class=dp-highlighter>
<DIV class=bar>
<DIV class=tools>Java代码</DIV>
</DIV>
<OL class=dp-j>
	<LI><SPAN><SPAN>jQuery.fn.init.prototype&nbsp;=&nbsp;jQuery.fn;&nbsp;&nbsp;</SPAN></SPAN></LI>
</OL>
</DIV>
<PRE style="DISPLAY: none" class=java name="code">jQuery.fn.init.prototype = jQuery.fn;</PRE>
<P>&nbsp;</P>
<P>所以 我们平常使用 $('#abc')&nbsp;或 jQuery('#abc')&nbsp;</P>
<P>&nbsp;</P>
<P><STRONG>$ 就是 jQuery，它返回一个对象。</STRONG> <STRONG>这个对象的构造函数是 jQuery.fn.init(...</STRONG></P>
<P>&nbsp;</P>
<P><STRONG>这个对象的实例方法和字段就是 jQuery.fn 的成员。</STRONG></P>
<P>&nbsp;</P>
<P>&nbsp;</P>
<DIV class=dp-highlighter>
<DIV class=bar>
<DIV class=tools>Java代码</DIV>
</DIV>
<OL class=dp-j>
	<LI><SPAN><SPAN>jQuery.fn&nbsp;=&nbsp;jQuery.prototype&nbsp;=&nbsp;{
	&nbsp;&nbsp;</SPAN></SPAN></LI>
	<LI><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;init:&nbsp;function(&nbsp;selector,&nbsp;context&nbsp;)&nbsp;{
	&nbsp;&nbsp;</SPAN></LI>
	<LI><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;... &nbsp;&nbsp;</SPAN></LI>
	<LI><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;}, &nbsp;&nbsp;</SPAN></LI>
	<LI><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;size:&nbsp;function()&nbsp;{ &nbsp;&nbsp;</SPAN></LI>
	<LI><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=keyword>return</SPAN><SPAN>&nbsp;</SPAN><SPAN
		class=keyword>this</SPAN><SPAN>.length; &nbsp;&nbsp;</SPAN></LI>
	<LI><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;}, &nbsp;&nbsp;</SPAN></LI>
	<LI><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;...&nbsp;&nbsp;</SPAN></LI>
</OL>
</DIV>
<PRE style="DISPLAY: none" class=java name="code">jQuery.fn = jQuery.prototype = {
	init: function( selector, context ) {
	...
	},
	size: function() {
		return this.length;
	},
        ...
</PRE>
<P>&nbsp;</P>
<P>从以上可以看出，下面的代码等效。</P>
<P>&nbsp;</P>
<P>var a = $('#id'); // a = new jQuery('#id');</P>
<P>a.size();</P>
<P>&nbsp;</P>
<P>&nbsp;</P>
<P>上面我们隐约看到了jQuery的插件结构， 你可以添加方法到 jQuery.fn，就可以在jQuery对象中使用。</P>
<P>&nbsp;</P>
<P>但首先，我们先看几个通用工具方法，因为其他很多部分使用它们。</P>
<P>&nbsp;</P>
<P><STRONG>2. 几个工具方法</STRONG></P>
<P>&nbsp;</P>
<P><STRONG>2.1</STRONG>&nbsp;<STRONG> jQuery.extend = jQuery.fn.extend</STRONG> = function() {</P>
<P>&nbsp;</P>
<P>我们分两部分看这个方法：首先是准备， 然后是拷贝。</P>
<P>&nbsp;</P>
<P>准备：</P>
<P>&nbsp;</P>
<DIV class=dp-highlighter>
<DIV class=bar>
<DIV class=tools>Js代码</DIV>
</DIV>
<OL class=dp-c>
	<LI><SPAN><SPAN>jQuery.extend&nbsp;=&nbsp;jQuery.fn.extend&nbsp;=&nbsp;</SPAN><SPAN
		class=keyword>function</SPAN><SPAN>()&nbsp;{ &nbsp;&nbsp;</SPAN></SPAN></LI>
	<LI><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=keyword>var</SPAN><SPAN>&nbsp;target&nbsp;=&nbsp;arguments[0]&nbsp;||&nbsp;{},&nbsp;i&nbsp;=&nbsp;1,&nbsp;length&nbsp;=&nbsp;arguments.length,&nbsp;deep&nbsp;=&nbsp;</SPAN><SPAN
		class=keyword>false</SPAN><SPAN>,&nbsp;options; &nbsp;&nbsp;</SPAN></LI>
	<LI><SPAN>&nbsp;&nbsp;</SPAN></LI>
	<LI><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=keyword>if</SPAN><SPAN>&nbsp;(&nbsp;</SPAN><SPAN
		class=keyword>typeof</SPAN><SPAN>&nbsp;target&nbsp;===&nbsp;</SPAN><SPAN class=string>"boolean"</SPAN><SPAN>&nbsp;)&nbsp;{
	&nbsp;&nbsp;</SPAN></LI>
	<LI><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;deep&nbsp;=&nbsp;target;
	&nbsp;&nbsp;</SPAN></LI>
	<LI><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;target&nbsp;=&nbsp;arguments[1]&nbsp;||&nbsp;{};
	&nbsp;&nbsp;</SPAN></LI>
	<LI><SPAN>&nbsp;&nbsp;</SPAN></LI>
	<LI><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;i&nbsp;=&nbsp;2; &nbsp;&nbsp;</SPAN></LI>
	<LI><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;} &nbsp;&nbsp;</SPAN></LI>
	<LI><SPAN>&nbsp;&nbsp;</SPAN></LI>
	<LI><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=keyword>if</SPAN><SPAN>&nbsp;(&nbsp;</SPAN><SPAN
		class=keyword>typeof</SPAN><SPAN>&nbsp;target&nbsp;!==&nbsp;</SPAN><SPAN class=string>"object"</SPAN><SPAN>&nbsp;&amp;&amp;&nbsp;!jQuery.isFunction(target)&nbsp;)
	&nbsp;&nbsp;</SPAN></LI>
	<LI><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;target&nbsp;=&nbsp;{};
	&nbsp;&nbsp;</SPAN></LI>
	<LI><SPAN>&nbsp;&nbsp;</SPAN></LI>
	<LI><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=keyword>if</SPAN><SPAN>&nbsp;(&nbsp;length&nbsp;==&nbsp;i&nbsp;)&nbsp;{
	&nbsp;&nbsp;</SPAN></LI>
	<LI><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;target&nbsp;=&nbsp;</SPAN><SPAN
		class=keyword>this</SPAN><SPAN>; &nbsp;&nbsp;</SPAN></LI>
	<LI><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--i; &nbsp;&nbsp;</SPAN></LI>
	<LI><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</SPAN></LI>
</OL>
</DIV>
<PRE style="DISPLAY: none" class=js name="code">jQuery.extend = jQuery.fn.extend = function() {
	var target = arguments[0] || {}, i = 1, length = arguments.length, deep = false, options;

	if ( typeof target === "boolean" ) {
		deep = target;
		target = arguments[1] || {};

		i = 2;
	}

	if ( typeof target !== "object" &amp;&amp; !jQuery.isFunction(target) )
		target = {};

	if ( length == i ) {
		target = this;
		--i;
	}</PRE>
<P>&nbsp;</P>
<P>可以看到，第一个参数可以指定为 boolean , 表示： 是否进行 深拷贝</P>
<P>&nbsp;</P>
<P>如果是多于一个 object，那么第一个object 为 target，它将被其他的 object 的成员扩展</P>
<P>如果仅有一个object， 那么 this （jQuery 或 jQuery.fn） 为 target,&nbsp; object 的成员将添加到 target中</P>
<P>&nbsp;</P>
<P>&nbsp;</P>
<P>我们常常这样使用:</P>
<P>&nbsp;</P>
<DIV class=dp-highlighter>
<DIV class=bar>
<DIV class=tools>Js代码</DIV>
</DIV>
<OL class=dp-c>
	<LI><SPAN><SPAN class=keyword>var</SPAN><SPAN>&nbsp;b&nbsp;=&nbsp;$.extend({},&nbsp;a);&nbsp;&nbsp;</SPAN><SPAN
		class=comment>//&nbsp;复制一份 </SPAN><SPAN>&nbsp;&nbsp;</SPAN></SPAN></LI>
	<LI><SPAN>&nbsp;&nbsp;</SPAN></LI>
	<LI><SPAN>options&nbsp;=&nbsp;$.extend({&nbsp;</SPAN><SPAN class=string>'name'</SPAN><SPAN>:&nbsp;</SPAN><SPAN
		class=string>'editor'</SPAN><SPAN>,&nbsp;value:&nbsp;</SPAN><SPAN class=string>'100'</SPAN><SPAN>&nbsp;},&nbsp;options);&nbsp;</SPAN><SPAN
		class=comment>//&nbsp;默认参数 </SPAN><SPAN>&nbsp;&nbsp;</SPAN></LI>
	<LI><SPAN>&nbsp;&nbsp;</SPAN></LI>
	<LI><SPAN>&nbsp;&nbsp;</SPAN></LI>
	<LI><SPAN>$.extend({ &nbsp;&nbsp;</SPAN></LI>
	<LI><SPAN>&nbsp;&nbsp;</SPAN></LI>
	<LI><SPAN>&nbsp;&nbsp;myfunc:&nbsp;</SPAN><SPAN class=keyword>function</SPAN><SPAN>()&nbsp;{...&nbsp;&nbsp;</SPAN><SPAN
		class=comment>//&nbsp;为jquery添加&nbsp;工具方法 </SPAN><SPAN>&nbsp;&nbsp;</SPAN></LI>
	<LI><SPAN>&nbsp;&nbsp;</SPAN></LI>
	<LI><SPAN>}); &nbsp;&nbsp;</SPAN></LI>
	<LI><SPAN>&nbsp;&nbsp;</SPAN></LI>
	<LI><SPAN>&nbsp;&nbsp;</SPAN></LI>
	<LI><SPAN>$.fn.extend({ &nbsp;&nbsp;</SPAN></LI>
	<LI><SPAN>&nbsp;&nbsp;</SPAN></LI>
	<LI><SPAN>&nbsp;&nbsp;myplugin:&nbsp;</SPAN><SPAN class=keyword>function</SPAN><SPAN>()&nbsp;{...&nbsp;&nbsp;</SPAN><SPAN
		class=comment>//&nbsp;为jquery添加插件 </SPAN><SPAN>&nbsp;&nbsp;</SPAN></LI>
	<LI><SPAN>&nbsp;&nbsp;</SPAN></LI>
	<LI><SPAN>})&nbsp;&nbsp;</SPAN></LI>
</OL>
</DIV>
<PRE style="DISPLAY: none" class=js name="code">var b = $.extend({}, a);  // 复制一份

options = $.extend({ 'name': 'editor', value: '100' }, options); // 默认参数


$.extend({

  myfunc: function() {...  // 为jquery添加 工具方法

});


$.fn.extend({

  myplugin: function() {...  // 为jquery添加插件

})</PRE>
<P>&nbsp;</P>
<P>&nbsp;</P>
<P>另一部分的拷贝代码也很容易：</P>
<P>&nbsp;</P>
<DIV class=dp-highlighter>
<DIV class=bar>
<DIV class=tools>Js代码</DIV>
</DIV>
<OL class=dp-c>
	<LI><SPAN><SPAN class=keyword>for</SPAN><SPAN>&nbsp;(&nbsp;;&nbsp;i&nbsp;&lt;&nbsp;length;&nbsp;i++&nbsp;)
	&nbsp;&nbsp;</SPAN></SPAN></LI>
	<LI><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=keyword>if</SPAN><SPAN>&nbsp;(&nbsp;(options&nbsp;=&nbsp;arguments[&nbsp;i&nbsp;])&nbsp;!=&nbsp;</SPAN><SPAN
		class=keyword>null</SPAN><SPAN>&nbsp;) &nbsp;&nbsp;</SPAN></LI>
	<LI><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=keyword>for</SPAN><SPAN>&nbsp;(&nbsp;</SPAN><SPAN
		class=keyword>var</SPAN><SPAN>&nbsp;name&nbsp;</SPAN><SPAN class=keyword>in</SPAN><SPAN>&nbsp;options&nbsp;)&nbsp;{
	&nbsp;&nbsp;</SPAN></LI>
	<LI><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN
		class=keyword>var</SPAN><SPAN>&nbsp;src&nbsp;=&nbsp;target[&nbsp;name&nbsp;],&nbsp;copy&nbsp;=&nbsp;options[&nbsp;name&nbsp;];
	&nbsp;&nbsp;</SPAN></LI>
	<LI><SPAN>&nbsp;&nbsp;</SPAN></LI>
	<LI><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN
		class=keyword>if</SPAN><SPAN>&nbsp;(&nbsp;target&nbsp;===&nbsp;copy&nbsp;) &nbsp;&nbsp;</SPAN></LI>
	<LI><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN
		class=keyword>continue</SPAN><SPAN>; &nbsp;&nbsp;</SPAN></LI>
	<LI><SPAN>&nbsp;&nbsp;</SPAN></LI>
	<LI><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN
		class=keyword>if</SPAN><SPAN>&nbsp;(&nbsp;deep&nbsp;&amp;&amp;&nbsp;copy&nbsp;&amp;&amp;&nbsp;</SPAN><SPAN
		class=keyword>typeof</SPAN><SPAN>&nbsp;copy&nbsp;===&nbsp;</SPAN><SPAN class=string>"object"</SPAN><SPAN>&nbsp;&amp;&amp;&nbsp;!copy.nodeType&nbsp;)
	&nbsp;&nbsp;</SPAN></LI>
	<LI><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;target[&nbsp;name&nbsp;]&nbsp;=&nbsp;jQuery.extend(&nbsp;deep,&nbsp;
	&nbsp;&nbsp;</SPAN></LI>
	<LI><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;src&nbsp;||&nbsp;(&nbsp;copy.length&nbsp;!=&nbsp;</SPAN><SPAN
		class=keyword>null</SPAN><SPAN>&nbsp;?&nbsp;[&nbsp;]&nbsp;:&nbsp;{&nbsp;}&nbsp;)
	&nbsp;&nbsp;</SPAN></LI>
	<LI><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;,&nbsp;copy&nbsp;);
	&nbsp;&nbsp;</SPAN></LI>
	<LI><SPAN>&nbsp;&nbsp;</SPAN></LI>
	<LI><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN
		class=keyword>else</SPAN><SPAN>&nbsp;</SPAN><SPAN class=keyword>if</SPAN><SPAN>&nbsp;(&nbsp;copy&nbsp;!==&nbsp;undefined&nbsp;)
	&nbsp;&nbsp;</SPAN></LI>
	<LI><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;target[&nbsp;name&nbsp;]&nbsp;=&nbsp;copy;
	&nbsp;&nbsp;</SPAN></LI>
	<LI><SPAN>&nbsp;&nbsp;</SPAN></LI>
	<LI><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} &nbsp;&nbsp;</SPAN></LI>
	<LI><SPAN>&nbsp;&nbsp;</SPAN></LI>
	<LI><SPAN></SPAN><SPAN class=keyword>return</SPAN><SPAN>&nbsp;target;&nbsp;&nbsp;</SPAN></LI>
</OL>
</DIV>
<PRE style="DISPLAY: none" class=js name="code">	for ( ; i &lt; length; i++ )
		if ( (options = arguments[ i ]) != null )
			for ( var name in options ) {
				var src = target[ name ], copy = options[ name ];

				if ( target === copy )
					continue;

				if ( deep &amp;&amp; copy &amp;&amp; typeof copy === "object" &amp;&amp; !copy.nodeType )
					target[ name ] = jQuery.extend( deep, 
						src || ( copy.length != null ? [ ] : { } )
					, copy );

				else if ( copy !== undefined )
					target[ name ] = copy;

			}

	return target;</PRE>
<P>&nbsp;</P>
<P><STRONG>2.2</STRONG>&nbsp; <STRONG>each(object, callback)</STRONG></P>
<P>&nbsp;</P>
<P>&nbsp;</P>
<DIV class=dp-highlighter>
<DIV class=bar>
<DIV class=tools>Js代码</DIV>
</DIV>
<OL class=dp-c>
	<LI><SPAN><SPAN class=comment>//&nbsp;args&nbsp;is&nbsp;for&nbsp;internal&nbsp;usage&nbsp;only
	</SPAN><SPAN>&nbsp;&nbsp;</SPAN></SPAN></LI>
	<LI><SPAN>each:&nbsp;</SPAN><SPAN class=keyword>function</SPAN><SPAN>(&nbsp;object,&nbsp;callback,&nbsp;args&nbsp;)&nbsp;{
	&nbsp;&nbsp;</SPAN></LI>
	<LI><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=keyword>var</SPAN><SPAN>&nbsp;name,&nbsp;i&nbsp;=&nbsp;0,&nbsp;length&nbsp;=&nbsp;object.length;
	&nbsp;&nbsp;</SPAN></LI>
	<LI><SPAN>&nbsp;&nbsp;</SPAN></LI>
	<LI><SPAN>..&nbsp;&nbsp;</SPAN></LI>
</OL>
</DIV>
<PRE style="DISPLAY: none" class=js name="code">	// args is for internal usage only
	each: function( object, callback, args ) {
		var name, i = 0, length = object.length;

...
</PRE>
<P>&nbsp;</P>
<P>&nbsp;</P>
<P>我们只使用到两个参数，args 内部使用。</P>
<P>&nbsp;</P>
<DIV class=dp-highlighter>
<DIV class=bar>
<DIV class=tools>Java代码</DIV>
</DIV>
<OL class=dp-j>
	<LI><SPAN><SPAN class=keyword>if</SPAN><SPAN>&nbsp;(&nbsp;args&nbsp;)&nbsp;{
	&nbsp;&nbsp;</SPAN></SPAN></LI>
	<LI><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=keyword>if</SPAN><SPAN>&nbsp;(&nbsp;length&nbsp;===&nbsp;undefined&nbsp;)&nbsp;{
	&nbsp;&nbsp;</SPAN></LI>
	<LI><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=keyword>for</SPAN><SPAN>&nbsp;(&nbsp;name&nbsp;in&nbsp;object&nbsp;)
	&nbsp;&nbsp;</SPAN></LI>
	<LI><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN
		class=keyword>if</SPAN><SPAN>&nbsp;(&nbsp;callback.apply(&nbsp;object[&nbsp;name&nbsp;],&nbsp;args&nbsp;)&nbsp;===&nbsp;</SPAN><SPAN
		class=keyword>false</SPAN><SPAN>&nbsp;) &nbsp;&nbsp;</SPAN></LI>
	<LI><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN
		class=keyword>break</SPAN><SPAN>; &nbsp;&nbsp;</SPAN></LI>
	<LI><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;</SPAN><SPAN class=keyword>else</SPAN><SPAN>&nbsp;&nbsp;</SPAN></LI>
	<LI><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=keyword>for</SPAN><SPAN>&nbsp;(&nbsp;;&nbsp;i&nbsp;&lt;&nbsp;length;&nbsp;)
	&nbsp;&nbsp;</SPAN></LI>
	<LI><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN
		class=keyword>if</SPAN><SPAN>&nbsp;(&nbsp;callback.apply(&nbsp;object[&nbsp;i++&nbsp;],&nbsp;args&nbsp;)&nbsp;===&nbsp;</SPAN><SPAN
		class=keyword>false</SPAN><SPAN>&nbsp;) &nbsp;&nbsp;</SPAN></LI>
	<LI><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN
		class=keyword>break</SPAN><SPAN>; &nbsp;&nbsp;</SPAN></LI>
	<LI><SPAN>&nbsp;&nbsp;</SPAN></LI>
	<LI><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=comment>//&nbsp;A&nbsp;special,&nbsp;fast,&nbsp;case&nbsp;for&nbsp;the&nbsp;most&nbsp;common&nbsp;use&nbsp;of&nbsp;each
	</SPAN><SPAN>&nbsp;&nbsp;</SPAN></LI>
	<LI><SPAN>}&nbsp;</SPAN><SPAN class=keyword>else</SPAN><SPAN>&nbsp;{&nbsp;&nbsp;</SPAN></LI>
</OL>
</DIV>
<PRE style="DISPLAY: none" class=java name="code">		if ( args ) {
			if ( length === undefined ) {
				for ( name in object )
					if ( callback.apply( object[ name ], args ) === false )
						break;
			} else
				for ( ; i &lt; length; )
					if ( callback.apply( object[ i++ ], args ) === false )
						break;

			// A special, fast, case for the most common use of each
		} else {</PRE>
<P>&nbsp;</P>
<P>这一部分是是框架内部使用。我们else部分：</P>
<P>&nbsp;</P>
<DIV class=dp-highlighter>
<DIV class=bar>
<DIV class=tools>Java代码</DIV>
</DIV>
<OL class=dp-j>
	<LI><SPAN><SPAN>}&nbsp;</SPAN><SPAN class=keyword>else</SPAN><SPAN>&nbsp;{
	&nbsp;&nbsp;</SPAN></SPAN></LI>
	<LI><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=keyword>if</SPAN><SPAN>&nbsp;(&nbsp;length&nbsp;===&nbsp;undefined&nbsp;)&nbsp;{
	&nbsp;&nbsp;</SPAN></LI>
	<LI><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=keyword>for</SPAN><SPAN>&nbsp;(&nbsp;name&nbsp;in&nbsp;object&nbsp;)
	&nbsp;&nbsp;</SPAN></LI>
	<LI><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN
		class=keyword>if</SPAN><SPAN>&nbsp;(&nbsp;callback.call(&nbsp;object[&nbsp;name&nbsp;],&nbsp;name,&nbsp;object[&nbsp;name&nbsp;]&nbsp;)&nbsp;===&nbsp;</SPAN><SPAN
		class=keyword>false</SPAN><SPAN>&nbsp;) &nbsp;&nbsp;</SPAN></LI>
	<LI><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN
		class=keyword>break</SPAN><SPAN>; &nbsp;&nbsp;</SPAN></LI>
	<LI><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;</SPAN><SPAN class=keyword>else</SPAN><SPAN>&nbsp;&nbsp;</SPAN></LI>
	<LI><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=keyword>for</SPAN><SPAN>&nbsp;(&nbsp;var&nbsp;value&nbsp;=&nbsp;object[</SPAN><SPAN
		class=number>0</SPAN><SPAN>]; &nbsp;&nbsp;</SPAN></LI>
	<LI><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;i&nbsp;&lt;&nbsp;length&nbsp;&amp;&amp;&nbsp;callback.call(&nbsp;value,&nbsp;i,&nbsp;value&nbsp;)&nbsp;!==&nbsp;</SPAN><SPAN
		class=keyword>false</SPAN><SPAN>;&nbsp; &nbsp;&nbsp;</SPAN></LI>
	<LI><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;value&nbsp;=&nbsp;object[++i]&nbsp;){}&nbsp;&nbsp;</SPAN></LI>
</OL>
</DIV>
<PRE style="DISPLAY: none" class=java name="code">		} else {
			if ( length === undefined ) {
				for ( name in object )
					if ( callback.call( object[ name ], name, object[ name ] ) === false )
						break;
			} else
				for ( var value = object[0];
					i &lt; length &amp;&amp; callback.call( value, i, value ) !== false; 
					value = object[++i] ){}</PRE>
<P>&nbsp;</P>
<P>&nbsp;从代码中，我们知道，可以对“数组”或“对象”进行迭代。</P>
<P>&nbsp;</P>
<DIV class=dp-highlighter>
<DIV class=bar>
<DIV class=tools>Java代码</DIV>
</DIV>
<OL class=dp-j>
	<LI><SPAN><SPAN>var&nbsp;a&nbsp;=&nbsp;[</SPAN><SPAN class=string>'a'</SPAN><SPAN>,&nbsp;</SPAN><SPAN
		class=string>'b'</SPAN><SPAN>,&nbsp;</SPAN><SPAN class=string>'c'</SPAN><SPAN>,&nbsp;</SPAN><SPAN
		class=string>'d'</SPAN><SPAN>,&nbsp;</SPAN><SPAN class=string>'e'</SPAN><SPAN>];
	&nbsp;&nbsp;</SPAN></SPAN></LI>
	<LI><SPAN>&nbsp;&nbsp;</SPAN></LI>
	<LI><SPAN>$.each(a,&nbsp;function()&nbsp;{ &nbsp;&nbsp;</SPAN></LI>
	<LI><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;alert(</SPAN><SPAN class=keyword>this</SPAN><SPAN>);&nbsp;&nbsp;</SPAN><SPAN
		class=comment>//&nbsp;this即每次迭代的值 </SPAN><SPAN>&nbsp;&nbsp;</SPAN></LI>
	<LI><SPAN>}); &nbsp;&nbsp;</SPAN></LI>
	<LI><SPAN>&nbsp;&nbsp;</SPAN></LI>
	<LI><SPAN>$.each(a,&nbsp;function(index,&nbsp;value)&nbsp;{ &nbsp;&nbsp;</SPAN></LI>
	<LI><SPAN>&nbsp;&nbsp;</SPAN><SPAN class=comment>//&nbsp;... </SPAN><SPAN>&nbsp;&nbsp;</SPAN></LI>
	<LI><SPAN>}); &nbsp;&nbsp;</SPAN></LI>
	<LI><SPAN>&nbsp;&nbsp;</SPAN></LI>
	<LI><SPAN>$.each(a,&nbsp;function()&nbsp;{ &nbsp;&nbsp;</SPAN></LI>
	<LI><SPAN>&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=keyword>if</SPAN><SPAN>&nbsp;(</SPAN><SPAN
		class=keyword>this</SPAN><SPAN>&nbsp;==&nbsp;</SPAN><SPAN class=string>'c'</SPAN><SPAN>)&nbsp;{
	&nbsp;&nbsp;</SPAN></LI>
	<LI><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=keyword>return</SPAN><SPAN>&nbsp;</SPAN><SPAN
		class=keyword>false</SPAN><SPAN>;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=comment>//&nbsp;'break'
	</SPAN><SPAN>&nbsp;&nbsp;</SPAN></LI>
	<LI><SPAN>&nbsp;&nbsp;} &nbsp;&nbsp;</SPAN></LI>
	<LI><SPAN>}&nbsp;&nbsp;</SPAN></LI>
</OL>
</DIV>
<PRE style="DISPLAY: none" class=java name="code">var a = ['a', 'b', 'c', 'd', 'e'];

$.each(a, function() {
    alert(this);  // this即每次迭代的值
});

$.each(a, function(index, value) {
  // ...
});

$.each(a, function() {
   if (this == 'c') {
    return false;    // 'break'
  }
}</PRE>
<P>&nbsp;</P>
<P>最后，<STRONG>each 返回 object 以支持链式调用</STRONG></P>
<P><STRONG></STRONG></P>
<P><STRONG></STRONG></P>
<P><STRONG></STRONG></P>
<P><STRONG></STRONG></P>
<P><STRONG>2.3&nbsp; isFunction(obj),&nbsp; isArray(obj), isXMLDoc(elem)</STRONG></P>
<P><STRONG></STRONG></P>
<P><STRONG></STRONG></P>
<P><STRONG></STRONG></P>
<P><STRONG>注: isXMLDoc 没有收录在API文档中， 所以不要使用。</STRONG></P>
<P><STRONG></STRONG></P>
<P><STRONG></STRONG></P>
<P><STRONG></STRONG></P>
<DIV class=dp-highlighter>
<DIV class=bar>
<DIV class=tools>Java代码</DIV>
</DIV>
<OL class=dp-j>
	<LI><SPAN><SPAN class=comment>//&nbsp;See&nbsp;test/unit/core.js&nbsp;for&nbsp;details&nbsp;concerning&nbsp;isFunction.
	</SPAN><SPAN>&nbsp;&nbsp;</SPAN></SPAN></LI>
	<LI><SPAN></SPAN><SPAN class=comment>//&nbsp;Since&nbsp;version&nbsp;1.3,&nbsp;DOM&nbsp;methods&nbsp;and&nbsp;functions&nbsp;like&nbsp;alert
	</SPAN><SPAN>&nbsp;&nbsp;</SPAN></LI>
	<LI><SPAN></SPAN><SPAN class=comment>//&nbsp;aren't&nbsp;supported.&nbsp;They&nbsp;return&nbsp;false&nbsp;on&nbsp;IE&nbsp;(#2968).
	</SPAN><SPAN>&nbsp;&nbsp;</SPAN></LI>
	<LI><SPAN>isFunction:&nbsp;function(&nbsp;obj&nbsp;)&nbsp;{ &nbsp;&nbsp;</SPAN></LI>
	<LI><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=keyword>return</SPAN><SPAN>&nbsp;toString.call(obj)&nbsp;===&nbsp;</SPAN><SPAN
		class=string>"[object&nbsp;Function]"</SPAN><SPAN>; &nbsp;&nbsp;</SPAN></LI>
	<LI><SPAN>}, &nbsp;&nbsp;</SPAN></LI>
	<LI><SPAN>&nbsp;&nbsp;</SPAN></LI>
	<LI><SPAN>isArray:&nbsp;function(&nbsp;obj&nbsp;)&nbsp;{ &nbsp;&nbsp;</SPAN></LI>
	<LI><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=keyword>return</SPAN><SPAN>&nbsp;toString.call(obj)&nbsp;===&nbsp;</SPAN><SPAN
		class=string>"[object&nbsp;Array]"</SPAN><SPAN>; &nbsp;&nbsp;</SPAN></LI>
	<LI><SPAN>}, &nbsp;&nbsp;</SPAN></LI>
	<LI><SPAN>&nbsp;&nbsp;</SPAN></LI>
	<LI><SPAN></SPAN><SPAN class=comment>//&nbsp;check&nbsp;if&nbsp;an&nbsp;element&nbsp;is&nbsp;in&nbsp;a&nbsp;(or&nbsp;is&nbsp;an)&nbsp;XML&nbsp;document
	</SPAN><SPAN>&nbsp;&nbsp;</SPAN></LI>
	<LI><SPAN>isXMLDoc:&nbsp;function(&nbsp;elem&nbsp;)&nbsp;{ &nbsp;&nbsp;</SPAN></LI>
	<LI><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=keyword>return</SPAN><SPAN>&nbsp;elem.nodeType&nbsp;===&nbsp;</SPAN><SPAN
		class=number>9</SPAN><SPAN>&nbsp;&amp;&amp;&nbsp;elem.documentElement.nodeName&nbsp;!==&nbsp;</SPAN><SPAN
		class=string>"HTML"</SPAN><SPAN>&nbsp;|| &nbsp;&nbsp;</SPAN></LI>
	<LI><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!!elem.ownerDocument&nbsp;&amp;&amp;&nbsp;jQuery.isXMLDoc(&nbsp;elem.ownerDocument&nbsp;);
	&nbsp;&nbsp;</SPAN></LI>
	<LI><SPAN>},&nbsp;&nbsp;</SPAN></LI>
</OL>
</DIV>
<PRE style="DISPLAY: none" class=java name="code">	// See test/unit/core.js for details concerning isFunction.
	// Since version 1.3, DOM methods and functions like alert
	// aren't supported. They return false on IE (#2968).
	isFunction: function( obj ) {
		return toString.call(obj) === "[object Function]";
	},

	isArray: function( obj ) {
		return toString.call(obj) === "[object Array]";
	},

	// check if an element is in a (or is an) XML document
	isXMLDoc: function( elem ) {
		return elem.nodeType === 9 &amp;&amp; elem.documentElement.nodeName !== "HTML" ||
			!!elem.ownerDocument &amp;&amp; jQuery.isXMLDoc( elem.ownerDocument );
	},</PRE>
<P>&nbsp;</P>
<P><STRONG>2.4&nbsp; trim(text)</STRONG></P>
<P><STRONG></STRONG></P>
<P><STRONG></STRONG></P>
<P>这个太熟悉不过了：</P>
<P>&nbsp;</P>
<P><STRONG></STRONG></P>
<DIV class=dp-highlighter>
<DIV class=bar>
<DIV class=tools>Java代码</DIV>
</DIV>
<OL class=dp-j>
	<LI><SPAN><SPAN>trim:&nbsp;function(&nbsp;text&nbsp;)&nbsp;{ &nbsp;&nbsp;</SPAN></SPAN></LI>
	<LI><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=keyword>return</SPAN><SPAN>&nbsp;(text&nbsp;||&nbsp;</SPAN><SPAN
		class=string>""</SPAN><SPAN>).replace(&nbsp;/^\s+|\s+$/g,&nbsp;</SPAN><SPAN class=string>""</SPAN><SPAN>&nbsp;);
	&nbsp;&nbsp;</SPAN></LI>
	<LI><SPAN>},&nbsp;&nbsp;</SPAN></LI>
</OL>
</DIV>
<PRE style="DISPLAY: none" class=java name="code">	trim: function( text ) {
		return (text || "").replace( /^\s+|\s+$/g, "" );
	},</PRE>
<P>&nbsp;</P>
<P>没有什么特殊的技巧， 使用简单的正则替换。</P>
<P>&nbsp;</P>
<P>prototype.js是这样的：</P>
<P>&nbsp;</P>
<DIV class=dp-highlighter>
<DIV class=bar>
<DIV class=tools>Js代码</DIV>
</DIV>
<OL class=dp-c>
	<LI><SPAN><SPAN>strip:&nbsp;</SPAN><SPAN class=keyword>function</SPAN><SPAN>()&nbsp;{
	&nbsp;&nbsp;</SPAN></SPAN></LI>
	<LI><SPAN>&nbsp;&nbsp;</SPAN><SPAN class=keyword>return</SPAN><SPAN>&nbsp;</SPAN><SPAN
		class=keyword>this</SPAN><SPAN>.replace(/^\s+/,&nbsp;</SPAN><SPAN class=string>''</SPAN><SPAN>).replace(/\s+$/,&nbsp;</SPAN><SPAN
		class=string>''</SPAN><SPAN>); &nbsp;&nbsp;</SPAN></LI>
	<LI><SPAN>},&nbsp;&nbsp;</SPAN></LI>
</OL>
</DIV>
<PRE style="DISPLAY: none" class=js name="code">  strip: function() {
    return this.replace(/^\s+/, '').replace(/\s+$/, '');
  },</PRE>
<P>&nbsp;</P>
<P><STRONG>2.5&nbsp; grep(array, callback, insert),&nbsp; map(array, callback)</STRONG></P>
<P>&nbsp;</P>
<DIV class=dp-highlighter>
<DIV class=bar>
<DIV class=tools>Js代码</DIV>
</DIV>
<OL class=dp-c>
	<LI><SPAN><SPAN>grep:&nbsp;</SPAN><SPAN class=keyword>function</SPAN><SPAN>(&nbsp;elems,&nbsp;callback,&nbsp;inv&nbsp;)&nbsp;{
	&nbsp;&nbsp;</SPAN></SPAN></LI>
	<LI><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=keyword>var</SPAN><SPAN>&nbsp;ret&nbsp;=&nbsp;[];
	&nbsp;&nbsp;</SPAN></LI>
	<LI><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=keyword>for</SPAN><SPAN>&nbsp;(&nbsp;</SPAN><SPAN
		class=keyword>var</SPAN><SPAN>&nbsp;i&nbsp;=&nbsp;0,&nbsp;length&nbsp;=&nbsp;elems.length;&nbsp;i&nbsp;&lt;&nbsp;length;&nbsp;i++&nbsp;)
	&nbsp;&nbsp;</SPAN></LI>
	<LI><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=keyword>if</SPAN><SPAN>&nbsp;(&nbsp;!inv&nbsp;!=&nbsp;!callback(&nbsp;elems[&nbsp;i&nbsp;],&nbsp;i&nbsp;)&nbsp;)
	&nbsp;&nbsp;</SPAN></LI>
	<LI><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ret.push(&nbsp;elems[&nbsp;i&nbsp;]&nbsp;);
	&nbsp;&nbsp;</SPAN></LI>
	<LI><SPAN>&nbsp;&nbsp;</SPAN></LI>
	<LI><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=keyword>return</SPAN><SPAN>&nbsp;ret;
	&nbsp;&nbsp;</SPAN></LI>
	<LI><SPAN>},&nbsp;&nbsp;</SPAN></LI>
</OL>
</DIV>
<PRE style="DISPLAY: none" class=js name="code">	grep: function( elems, callback, inv ) {
		var ret = [];
		for ( var i = 0, length = elems.length; i &lt; length; i++ )
			if ( !inv != !callback( elems[ i ], i ) )
				ret.push( elems[ i ] );

		return ret;
	},</PRE>
<P>&nbsp;</P>
<P>所以我们这样使用：</P>
<P>&nbsp;</P>
<DIV class=dp-highlighter>
<DIV class=bar>
<DIV class=tools>Js代码</DIV>
</DIV>
<OL class=dp-c>
	<LI><SPAN><SPAN class=keyword>var</SPAN><SPAN>&nbsp;a&nbsp;=&nbsp;[2,&nbsp;3,&nbsp;6,&nbsp;1,&nbsp;8,&nbsp;9];
	&nbsp;&nbsp;</SPAN></SPAN></LI>
	<LI><SPAN>&nbsp;&nbsp;</SPAN></LI>
	<LI><SPAN>$.grep(a,&nbsp;</SPAN><SPAN class=keyword>function</SPAN><SPAN>(v)&nbsp;{&nbsp;&nbsp;</SPAN><SPAN
		class=comment>//&nbsp;&nbsp;&nbsp;只要&gt;=&nbsp;3的数 </SPAN><SPAN>&nbsp;&nbsp;</SPAN></LI>
	<LI><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=keyword>return</SPAN><SPAN>&nbsp;v&nbsp;&gt;=&nbsp;3;
	&nbsp;&nbsp;</SPAN></LI>
	<LI><SPAN>}); &nbsp;&nbsp;</SPAN></LI>
	<LI><SPAN>&nbsp;&nbsp;</SPAN></LI>
	<LI><SPAN>$.grep(a,&nbsp;</SPAN><SPAN class=keyword>function</SPAN><SPAN>(v)&nbsp;{
	&nbsp;&nbsp;</SPAN></LI>
	<LI><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=keyword>return</SPAN><SPAN>&nbsp;v&nbsp;&gt;=&nbsp;3;
	&nbsp;&nbsp;</SPAN></LI>
	<LI><SPAN>},&nbsp;</SPAN><SPAN class=keyword>false</SPAN><SPAN>);&nbsp;</SPAN><SPAN
		class=comment>//&nbsp;这样相当于&nbsp;&lt;&nbsp;3</SPAN><SPAN>&nbsp;&nbsp;</SPAN></LI>
</OL>
</DIV>
<PRE style="DISPLAY: none" class=js name="code">var a = [2, 3, 6, 1, 8, 9];

$.grep(a, function(v) {  //   只要&gt;= 3的数
    return v &gt;= 3;
});

$.grep(a, function(v) {
    return v &gt;= 3;
}, false); // 这样相当于 &lt; 3</PRE>
<P>&nbsp;</P>
<P>下面是map</P>
<P>&nbsp;</P>
<DIV class=dp-highlighter>
<DIV class=bar>
<DIV class=tools>Java代码</DIV>
</DIV>
<OL class=dp-j>
	<LI><SPAN><SPAN>map:&nbsp;function(&nbsp;elems,&nbsp;callback&nbsp;)&nbsp;{
	&nbsp;&nbsp;</SPAN></SPAN></LI>
	<LI><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;ret&nbsp;=&nbsp;[]; &nbsp;&nbsp;</SPAN></LI>
	<LI><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=keyword>for</SPAN><SPAN>&nbsp;(&nbsp;var&nbsp;i&nbsp;=&nbsp;</SPAN><SPAN
		class=number>0</SPAN><SPAN>,&nbsp;length&nbsp;=&nbsp;elems.length;&nbsp;i&nbsp;&lt;&nbsp;length;&nbsp;i++&nbsp;)&nbsp;{
	&nbsp;&nbsp;</SPAN></LI>
	<LI><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;value&nbsp;=&nbsp;callback(&nbsp;elems[&nbsp;i&nbsp;],&nbsp;i&nbsp;);
	&nbsp;&nbsp;</SPAN></LI>
	<LI><SPAN>&nbsp;&nbsp;</SPAN></LI>
	<LI><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=keyword>if</SPAN><SPAN>&nbsp;(&nbsp;value&nbsp;!=&nbsp;</SPAN><SPAN
		class=keyword>null</SPAN><SPAN>&nbsp;) &nbsp;&nbsp;</SPAN></LI>
	<LI><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ret[&nbsp;ret.length&nbsp;]&nbsp;=&nbsp;value;
	&nbsp;&nbsp;</SPAN></LI>
	<LI><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;} &nbsp;&nbsp;</SPAN></LI>
	<LI><SPAN>&nbsp;&nbsp;</SPAN></LI>
	<LI><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=keyword>return</SPAN><SPAN>&nbsp;ret.concat.apply(&nbsp;[],&nbsp;ret&nbsp;);
	&nbsp;&nbsp;</SPAN></LI>
	<LI><SPAN>}&nbsp;&nbsp;</SPAN></LI>
</OL>
</DIV>
<PRE style="DISPLAY: none" class=java name="code">	map: function( elems, callback ) {
		var ret = [];
		for ( var i = 0, length = elems.length; i &lt; length; i++ ) {
			var value = callback( elems[ i ], i );

			if ( value != null )
				ret[ ret.length ] = value;
		}

		return ret.concat.apply( [], ret );
	}</PRE>
<P>&nbsp;</P>
<P>最后一句话是干嘛？ return ret.concat.apply( [], ret );</P>
<P>上面的相当于：&nbsp; return [].concat(ret[0], ret[1], ...);</P>
<P>&nbsp;</P>
<P>var a = [].concat(1, 2, 3, [4, 5])&nbsp;; // a = [1, 2, 3, 4, 5];</P>
<P>&nbsp;</P>
<P>原来这样是让函数更灵活， 让我们可以这样使用：</P>
<P>&nbsp;</P>
<DIV class=dp-highlighter>
<DIV class=bar>
<DIV class=tools>Js代码</DIV>
</DIV>
<OL class=dp-c>
	<LI><SPAN><SPAN>a&nbsp;=&nbsp;[1,&nbsp;2,&nbsp;3,&nbsp;4]; &nbsp;&nbsp;</SPAN></SPAN></LI>
	<LI><SPAN>&nbsp;&nbsp;</SPAN></LI>
	<LI><SPAN>b&nbsp;=&nbsp;$.map(a,&nbsp;</SPAN><SPAN class=keyword>function</SPAN><SPAN>(v)&nbsp;{
	&nbsp;&nbsp;</SPAN></LI>
	<LI><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=keyword>return</SPAN><SPAN>&nbsp;[v,&nbsp;2&nbsp;*&nbsp;v];
	&nbsp;&nbsp;</SPAN></LI>
	<LI><SPAN>}); &nbsp;&nbsp;</SPAN></LI>
	<LI><SPAN>&nbsp;&nbsp;</SPAN></LI>
	<LI><SPAN></SPAN><SPAN class=comment>//&nbsp;b&nbsp;=&nbsp;[1,&nbsp;2,&nbsp;2,&nbsp;4,&nbsp;3,&nbsp;6,&nbsp;4,&nbsp;8];</SPAN><SPAN>&nbsp;&nbsp;</SPAN></LI>
</OL>
</DIV>
<PRE style="DISPLAY: none" class=js name="code">a = [1, 2, 3, 4];

b = $.map(a, function(v) {
	return [v, 2 * v];
});

// b = [1, 2, 2, 4, 3, 6, 4, 8];</PRE>
<P>&nbsp;</P>
<P><STRONG>返回值为null 会被过滤</STRONG></P>
<P><STRONG></STRONG></P>
<P><STRONG></STRONG></P>
<P><STRONG></STRONG></P>
<P><STRONG></STRONG></P>
<P><STRONG></STRONG>&nbsp;</P>
<P>---</P>
<P><STRONG></STRONG>&nbsp;</P>
<P><STRONG>2</STRONG><STRONG>.6 makeArray(obj),&nbsp; inArray(value, array)</STRONG></P>
<P><STRONG></STRONG>&nbsp;</P>
<DIV class=dp-highlighter>
<DIV class=bar>
<DIV class=tools>Js代码</DIV>
</DIV>
<OL class=dp-c>
	<LI><SPAN><SPAN>makeArray:&nbsp;</SPAN><SPAN class=keyword>function</SPAN><SPAN>(&nbsp;array&nbsp;)&nbsp;{
	&nbsp;&nbsp;</SPAN></SPAN></LI>
	<LI><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=keyword>var</SPAN><SPAN>&nbsp;ret&nbsp;=&nbsp;[];
	&nbsp;&nbsp;</SPAN></LI>
	<LI><SPAN>&nbsp;&nbsp;</SPAN></LI>
	<LI><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=keyword>if</SPAN><SPAN>(&nbsp;array&nbsp;!=&nbsp;</SPAN><SPAN
		class=keyword>null</SPAN><SPAN>&nbsp;){ &nbsp;&nbsp;</SPAN></LI>
	<LI><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=keyword>var</SPAN><SPAN>&nbsp;i&nbsp;=&nbsp;array.length;
	&nbsp;&nbsp;</SPAN></LI>
	<LI><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=comment>//&nbsp;The&nbsp;window,&nbsp;strings&nbsp;(and&nbsp;functions)&nbsp;also&nbsp;have&nbsp;'length'
	</SPAN><SPAN>&nbsp;&nbsp;</SPAN></LI>
	<LI><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=keyword>if</SPAN><SPAN>(&nbsp;i&nbsp;==&nbsp;</SPAN><SPAN
		class=keyword>null</SPAN><SPAN>&nbsp;||&nbsp;</SPAN><SPAN class=keyword>typeof</SPAN><SPAN>&nbsp;array&nbsp;===&nbsp;</SPAN><SPAN
		class=string>"string"</SPAN><SPAN>&nbsp;||&nbsp;jQuery.isFunction(array)&nbsp;||&nbsp;array.setInterval&nbsp;)
	&nbsp;&nbsp;</SPAN></LI>
	<LI><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ret[0]&nbsp;=&nbsp;array;
	&nbsp;&nbsp;</SPAN></LI>
	<LI><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=keyword>else</SPAN><SPAN>&nbsp;&nbsp;</SPAN></LI>
	<LI><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN
		class=keyword>while</SPAN><SPAN>(&nbsp;i&nbsp;) &nbsp;&nbsp;</SPAN></LI>
	<LI><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ret[--i]&nbsp;=&nbsp;array[i];
	&nbsp;&nbsp;</SPAN></LI>
	<LI><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;} &nbsp;&nbsp;</SPAN></LI>
	<LI><SPAN>&nbsp;&nbsp;</SPAN></LI>
	<LI><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=keyword>return</SPAN><SPAN>&nbsp;ret;
	&nbsp;&nbsp;</SPAN></LI>
	<LI><SPAN>},&nbsp;&nbsp;</SPAN></LI>
</OL>
</DIV>
<PRE style="DISPLAY: none" class=js name="code">	makeArray: function( array ) {
		var ret = [];

		if( array != null ){
			var i = array.length;
			// The window, strings (and functions) also have 'length'
			if( i == null || typeof array === "string" || jQuery.isFunction(array) || array.setInterval )
				ret[0] = array;
			else
				while( i )
					ret[--i] = array[i];
		}

		return ret;
	},</PRE>
<P>&nbsp;</P>
<P>&nbsp;</P>
<P>如果没有length属性，或者是 string, function window 之一， 就返回一个元素的数组。</P>
<P><STRONG></STRONG></P>
<P>&nbsp;</P>
<P>&nbsp;</P>
<DIV class=dp-highlighter>
<DIV class=bar>
<DIV class=tools>Js代码</DIV>
</DIV>
<OL class=dp-c>
	<LI><SPAN><SPAN>inArray:&nbsp;</SPAN><SPAN class=keyword>function</SPAN><SPAN>(&nbsp;elem,&nbsp;array&nbsp;)&nbsp;{
	&nbsp;&nbsp;</SPAN></SPAN></LI>
	<LI><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=keyword>for</SPAN><SPAN>&nbsp;(&nbsp;</SPAN><SPAN
		class=keyword>var</SPAN><SPAN>&nbsp;i&nbsp;=&nbsp;0,&nbsp;length&nbsp;=&nbsp;array.length;&nbsp;i&nbsp;&lt;&nbsp;length;&nbsp;i++&nbsp;)
	&nbsp;&nbsp;</SPAN></LI>
	<LI><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=comment>//&nbsp;Use&nbsp;===&nbsp;because&nbsp;on&nbsp;IE,&nbsp;window&nbsp;==&nbsp;document
	</SPAN><SPAN>&nbsp;&nbsp;</SPAN></LI>
	<LI><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=keyword>if</SPAN><SPAN>&nbsp;(&nbsp;array[&nbsp;i&nbsp;]&nbsp;===&nbsp;elem&nbsp;)
	&nbsp;&nbsp;</SPAN></LI>
	<LI><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN
		class=keyword>return</SPAN><SPAN>&nbsp;i; &nbsp;&nbsp;</SPAN></LI>
	<LI><SPAN>&nbsp;&nbsp;</SPAN></LI>
	<LI><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=keyword>return</SPAN><SPAN>&nbsp;-1;
	&nbsp;&nbsp;</SPAN></LI>
	<LI><SPAN>},&nbsp;&nbsp;</SPAN></LI>
</OL>
</DIV>
<PRE style="DISPLAY: none" class=js name="code">	inArray: function( elem, array ) {
		for ( var i = 0, length = array.length; i &lt; length; i++ )
		// Use === because on IE, window == document
			if ( array[ i ] === elem )
				return i;

		return -1;
	},</PRE>
<P>&nbsp;</P>
<P>如果元素elm在 array中，返回位置，否则返回-1</P>
<P>&nbsp;</P>
<P><STRONG>&nbsp; 2.7 merge(first, second)</STRONG></P>
<P>&nbsp;</P>
<P>&nbsp;</P>
<P>&nbsp;</P>
<DIV class=dp-highlighter>
<DIV class=bar>
<DIV class=tools>Js代码</DIV>
</DIV>
<OL class=dp-c>
	<LI><SPAN><SPAN>merge:&nbsp;</SPAN><SPAN class=keyword>function</SPAN><SPAN>(&nbsp;first,&nbsp;second&nbsp;)&nbsp;{
	&nbsp;&nbsp;</SPAN></SPAN></LI>
	<LI><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=comment>//&nbsp;We&nbsp;have&nbsp;to&nbsp;loop&nbsp;this&nbsp;way&nbsp;because&nbsp;IE&nbsp;&amp;&nbsp;Opera&nbsp;overwrite&nbsp;the&nbsp;length
	</SPAN><SPAN>&nbsp;&nbsp;</SPAN></LI>
	<LI><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=comment>//&nbsp;expando&nbsp;of&nbsp;getElementsByTagName
	</SPAN><SPAN>&nbsp;&nbsp;</SPAN></LI>
	<LI><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=keyword>var</SPAN><SPAN>&nbsp;i&nbsp;=&nbsp;0,&nbsp;elem,&nbsp;pos&nbsp;=&nbsp;first.length;
	&nbsp;&nbsp;</SPAN></LI>
	<LI><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=comment>//&nbsp;Also,&nbsp;we&nbsp;need&nbsp;to&nbsp;make&nbsp;sure&nbsp;that&nbsp;the&nbsp;correct&nbsp;elements&nbsp;are&nbsp;being&nbsp;returned
	</SPAN><SPAN>&nbsp;&nbsp;</SPAN></LI>
	<LI><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=comment>//&nbsp;(IE&nbsp;returns&nbsp;comment&nbsp;nodes&nbsp;in&nbsp;a&nbsp;'*'&nbsp;query)
	</SPAN><SPAN>&nbsp;&nbsp;</SPAN></LI>
	<LI><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=keyword>if</SPAN><SPAN>&nbsp;(&nbsp;!jQuery.support.getAll&nbsp;)&nbsp;{
	&nbsp;&nbsp;</SPAN></LI>
	<LI><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=keyword>while</SPAN><SPAN>&nbsp;(&nbsp;(elem&nbsp;=&nbsp;second[&nbsp;i++&nbsp;])&nbsp;!=&nbsp;</SPAN><SPAN
		class=keyword>null</SPAN><SPAN>&nbsp;) &nbsp;&nbsp;</SPAN></LI>
	<LI><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN
		class=keyword>if</SPAN><SPAN>&nbsp;(&nbsp;elem.nodeType&nbsp;!=&nbsp;8&nbsp;) &nbsp;&nbsp;</SPAN></LI>
	<LI><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;first[&nbsp;pos++&nbsp;]&nbsp;=&nbsp;elem;
	&nbsp;&nbsp;</SPAN></LI>
	<LI><SPAN>&nbsp;&nbsp;</SPAN></LI>
	<LI><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;</SPAN><SPAN class=keyword>else</SPAN><SPAN>&nbsp;&nbsp;</SPAN></LI>
	<LI><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=keyword>while</SPAN><SPAN>&nbsp;(&nbsp;(elem&nbsp;=&nbsp;second[&nbsp;i++&nbsp;])&nbsp;!=&nbsp;</SPAN><SPAN
		class=keyword>null</SPAN><SPAN>&nbsp;) &nbsp;&nbsp;</SPAN></LI>
	<LI><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;first[&nbsp;pos++&nbsp;]&nbsp;=&nbsp;elem;
	&nbsp;&nbsp;</SPAN></LI>
	<LI><SPAN>&nbsp;&nbsp;</SPAN></LI>
	<LI><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=keyword>return</SPAN><SPAN>&nbsp;first;
	&nbsp;&nbsp;</SPAN></LI>
	<LI><SPAN>},&nbsp;&nbsp;</SPAN></LI>
</OL>
</DIV>
<PRE style="DISPLAY: none" class=js name="code">	merge: function( first, second ) {
		// We have to loop this way because IE &amp; Opera overwrite the length
		// expando of getElementsByTagName
		var i = 0, elem, pos = first.length;
		// Also, we need to make sure that the correct elements are being returned
		// (IE returns comment nodes in a '*' query)
		if ( !jQuery.support.getAll ) {
			while ( (elem = second[ i++ ]) != null )
				if ( elem.nodeType != 8 )
					first[ pos++ ] = elem;

		} else
			while ( (elem = second[ i++ ]) != null )
				first[ pos++ ] = elem;

		return first;
	},</PRE>
<P>&nbsp;</P>
<P><STRONG>但是我不知道 jQuery.support.getAll 是哪里来的？</STRONG></P>
<P><STRONG></STRONG></P>
<P><STRONG></STRONG></P>
<P><STRONG>只有 jQuery.support.objectAll， 这里会不会是笔误？ </STRONG></P>
<P><STRONG></STRONG></P>
<P>&nbsp;</P>
<P>&nbsp;整理一下先：</P>
<P>&nbsp;</P>
<P><IMG alt="" src="../../../img/files/jslib/fq1.gif"></P>
<P><STRONG></STRONG></P>
<P>&nbsp;</P>
<P>(PS: 本来想全部写好才发布的，但一开始保存在草稿箱中，后来修改的时候不小心按错了， 就将错就错，还是把它分成几部分，否则太长了）</P>
</DIV>

</body>
</html>